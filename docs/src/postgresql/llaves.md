---
outline: deep
---

# Comandos para crear llaves primarias y foráneas

## Llave primaria (PK)

### Agregar campo como PK

```sql
ALTER TABLE country
ADD PRIMARY KEY (code);
```

### Constraint CHECK

Consiste en verificaciones a un campo o varios.

Ejemplo: Agregar un check donde la surfacearea debe ser mayor a cero

```sql
ALTER TABLE COUNTRY
ADD CHECK(surfacearea >= 0);
```


## Llave Foránea (FK)

### Crear llaves foraneas 

Modificando la tabla para agregar un Foreign Key a un campo.

Ejemplo: Agregar a la tabla **city** la clave foranea *countrycode* de la tabla **country**

```sql
ALTER TABLE city
	ADD CONSTRAINT fk_country_code -- nombre de la clave foranea
	FOREIGN KEY (countrycode) -- campo con el que se relaciona
	REFERENCES country (code); -- a que tabla y campo hace referencia
```


## SERIAL vs IDENTITY

* SERIAL: para crear un identificador correlativo. Crea  automaticamente la secuencia.

```sql
CREATE TABLE users (
	user_id SERIAL PRIMARY KEY,
	username VARCHAR);
```

* IDENTITY:

1. Verifica que no se ingresen id de forma manual.

```sql
CREATE TABLE users2 (
	user_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	username VARCHAR);
```

2. Evita que se manipule el campo user_id.

```sql
CREATE TABLE users3 (
	user_id INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
	username VARCHAR);
```

3. Permite más control para la creación.

```sql
CREATE TABLE users4 (
	user_id INTEGER GENERATED ALWAYS AS IDENTITY (START WITH 100 INCREMENT BY 2),
	username VARCHAR);
```

## Llave Primaria Compuesta

La combinación de estas llaves es **ÚNICA**. Jamás se va a repetir.

Ejemplo: un usuario con los post de Tweeter:


```sql
CREATE TABLE usersDual (
	id1 int,
	id2 int,
	PRIMARY KEY (id1, id2)
);
```

|id1	|id2	|
|-------|-------|
|1		|1		|
|1		|2		|
|2		|1		|
|2		|2		|


## UUID

### Comando para generar UUID de PostgreSQL

```sql
SELECT gen_random_uuid();
```

Se debe crear una extensión para poder usar **uuid-ossp**, ya que no viene en PostgreSQL por defecto.

```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
```

Esta extensión nos crea todas las funciones de UUID. Se pueden ver en la carpeta **Funciones**.

<p align="center">
  <img src="/uuid.png" width="800" alt="uuid"/>
</p>

Para más información visite: https://www.postgresql.org/docs/current/uuid-ossp.html

```sql
SELECT uuid_generate_v4();
```
Este **SELECT** genera un UUID versión 4, que se deriva enteramente de números aleatorios.


Ahora crearemos un usuario usando el UUID:

```sql
CREATE TABLE users5 (
	"user_id" UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
	"username" VARCHAR
);
```

### Borrar todas las extensiones

```sql
DROP EXTENSION "uuid-ossp";
```